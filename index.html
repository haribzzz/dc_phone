<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DC PHONE</title>
  <link rel="stylesheet" href="style.css">
  <style>
    :root{
      --dark:#190019;
      --deep:#2B124C;
      --mid:#522B5B;
      --accent:#854F6C;
      --soft:#DFB6B2;
      --bg:#FBE4D8;
      --glass: rgba(255,255,255,0.6);
      --card-shadow: 0 14px 40px rgba(25,0,25,0.10);
    }

    body {
      background: radial-gradient(circle at 10% 10%, rgba(133,79,108,0.06), transparent 20%), var(--bg);
      color: var(--dark);
      -webkit-font-smoothing:antialiased;
    }

    header {
      background: linear-gradient(90deg, var(--deep), var(--mid));
      color: var(--soft);
      box-shadow: 0 6px 24px rgba(43,18,76,0.12);
    }
    .header-left h1 { color: var(--soft); margin:0; }
    .header-left .slogan { color: var(--accent); margin:0; font-style:italic; }

    /* Contenedor centrado para la barra de b√∫squeda */
    .search-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 16px;
    }

    .search-bar { 
      display:flex; 
      gap:15px; 
      align-items:center;
      justify-content: center;
      max-width: 1000px; /* M√°s ancho */
      width: 100%;
    }

    .logo-container {
      flex-shrink: 0;
    }

    .store-logo {
      height: 120px; /* Logo m√°s grande */
      width: auto;
      border-radius: 8px;
    }

    .search-bar input[type="search"]{
      flex: 1;
      max-width: 800px; /* Barra m√°s larga */
      min-width: 250px;
      padding:14px 20px; /* Un poco m√°s de padding */
      border:1px solid rgba(25,0,25,0.06);
      border-radius:999px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 6px 16px rgba(25,0,25,0.06);
      color: var(--dark);
      font-size: 16px;
    }

    .category-dropdown { flex: 0 0 auto; display:flex; align-items:center; gap:10px; }
    .category-toggle { white-space: nowrap; padding:10px 16px; border-radius:14px; font-size: 14px; }
    .search-btn { padding:10px 16px; border-radius:14px; background:var(--soft); border:1px solid rgba(25,0,25,0.06); color:var(--dark); font-weight:700; cursor:pointer; font-size: 14px; }
    .category-panel { min-width: 360px; }

    .search-bar select,
    .search-bar button {
      padding:10px 14px;
      border-radius:10px;
      border:1px solid rgba(25,0,25,0.06);
      background: white;
      color: var(--dark);
      font-weight:600;
    }
    .search-bar button {
      background: var(--soft);
      cursor:pointer;
      font-weight:700;
    }

    #products-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 14px;
      align-items: start;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.98), #fffaf9);
      border-radius:12px;
      padding:12px;
      text-align:center;
      border:1px solid rgba(82,43,91,0.06);
      box-shadow: var(--card-shadow);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .card:hover { transform: translateY(-8px); box-shadow: 0 18px 40px rgba(25,0,25,0.12); }
    .card img {
      width:100%;
      aspect-ratio: 3/4;
      height: auto;
      max-height: 260px;
      min-height: 200px;
      object-fit:cover;
      border-radius:8px;
      background:var(--glass);
    }
    .card .name { color: var(--deep); font-weight:700; }
    .card .price { color: var(--accent); font-weight:800; }

    .modal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(9,3,9,0.45); z-index:1000; padding:20px; }
    .modal.open { display:flex; }
    .modal-content {
      background: linear-gradient(180deg, #fff, #fffaf9);
      border-radius:12px;
      max-width:900px;
      width: min(900px, 96%);
      max-height:85vh;
      overflow:auto;
      padding:22px;
      box-shadow: 0 20px 60px rgba(9,3,9,0.3);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:20px;
      position:relative;
    }
    body.modal-open { overflow: hidden; height: 100vh; }

    .modal-left { display:flex; align-items:center; justify-content:center; }
    
    /* Zoom con desplazamiento */
    .modal-image-wrap { 
      position: relative; 
      width:100%;
      height: 360px;
      overflow: hidden;
      border-radius:10px;
      cursor: pointer;
    }
    .modal-image-wrap.zoomed {
      cursor: grab;
    }
    .modal-image-wrap.zoomed:active {
      cursor: grabbing;
    }
    .modal-image-wrap img { 
      width: 100%;
      height: 100%;
      object-fit: contain;
      background:#fafafa;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.03);
      transition: transform 0.1s ease;
      transform-origin: 0 0;
    }

    .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #c0392b;
      color: #ffffff;
      width: 42px;
      height: 42px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      border: none;
      font-weight:700;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(192,57,43,0.18);
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
      z-index: 10;
    }
    .close-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 26px rgba(192,57,43,0.22); opacity:0.95; }

    .modal-right { overflow:auto; }
     .availability.available { color:#0a7; font-weight:700; }
     .availability.not-available { color:#b00; font-weight:700; }

    footer { background: linear-gradient(90deg, var(--deep), var(--mid)); color: var(--soft); }

    @media (max-width:1000px){
      #products-grid { grid-template-columns: repeat(2,1fr); }
    }
    @media (max-width:620px){
      #products-grid { grid-template-columns: 1fr; }
      .card img { max-height:220px; min-height:120px; }
      .modal-content { grid-template-columns:1fr; padding:16px; }
      .search-bar { flex-direction: column; gap: 12px; }
      .search-bar input[type="search"]{ max-width:100%; }
      .category-panel { position:relative; max-height:240px; min-width: auto; width:100%; }
      .logo-container { display: none; } /* Ocultar logo en m√≥vil para ahorrar espacio */
    }
    @media (max-width:1200px){
       #products-grid { grid-template-columns: repeat(4,1fr); }
    }
    @media (max-width:900px){
       #products-grid { grid-template-columns: repeat(3,1fr); }
    }
    @media (max-width:700px){
       #products-grid { grid-template-columns: repeat(2,1fr); }
    }
    @media (max-width:480px){
       #products-grid { grid-template-columns: 1fr; }
        .card img { max-height: 160px; min-height: 90px; }
      }

    .category-panel .cat-row.cat-selected {
      background: rgba(43,18,76,0.06);
      border-radius: 6px;
      padding-left: 8px;
      padding-right: 8px;
    }
    .category-panel .cat-row.cat-selected span {
      color: var(--deep);
      font-weight: 700;
    }

    .hidden { display: none !important; }

    /* Icono de lupa */
    .zoom-icon {
      position: absolute;
      bottom: 12px;
      right: 12px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: var(--dark);
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform .12s ease, box-shadow .12s ease;
      z-index: 20;
    }
    .zoom-icon:hover { transform: scale(1.1); box-shadow: 0 6px 18px rgba(0,0,0,0.18); }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <h1>DC PHONE</h1>
      <p class="slogan">TU MEJOR OPCI√ìN, SIEMPRE ES CON <strong>NOSOTROS</strong></p>
    </div>
    <div class="social-icons">
      <a href="https://www.facebook.com/share/1CPWdYZ1L4/" target="_blank" rel="noopener noreferrer">
        <img src="images/Facebook.png" width="60" height="60" alt="Facebook">
      </a>
      <a href="https://www.instagram.com/dcphone28?igsh=MTBjaTAwNG9xaXVweg==" target="_blank" rel="noopener noreferrer">
        <img src="images/Instagram.png" width="60" height="60" alt="Instagram">
      </a>
      <a href="https://wa.me/76640026" target="_blank" rel="noopener noreferrer">
        <img src="images/WhatsApp.png" width="60" height="60" alt="WhatsApp">
      </a>
    </div>
  </header>

  <main>
    <!-- Se quit√≥ el t√≠tulo "Productos" -->
    
    <div class="container">
      <section class="products-section">
        <!-- Contenedor centrado con logo y barra de b√∫squeda -->
        <div class="search-container">
          <div class="search-bar">
            <div class="logo-container">
              <img src="images/DC_PHONE.png" alt="DC PHONE Logo" class="store-logo">
            </div>
            <input id="search-input" type="search" placeholder="Buscar producto por nombre, descripci√≥n, especificaciones..." />
            <div class="category-dropdown" id="category-dropdown" style="position:relative;">
              <button id="category-toggle" type="button" class="category-toggle">Todas las categor√≠as ‚ñæ</button>
              <button id="search-button" class="search-btn" type="button" aria-label="Buscar">Buscar</button>
               <div id="category-panel" class="category-panel hidden" aria-hidden="true" style="position:absolute; left:0; top:calc(100% + 8px); z-index:50; background:#fff; border:1px solid rgba(0,0,0,0.08); border-radius:8px; box-shadow:0 10px 30px rgba(0,0,0,0.12); max-height:320px; overflow:auto; padding:12px; min-width:360px;">
               </div>
             </div>
          </div>
        </div>

        <div id="products-grid" aria-live="polite">
        </div>
      </section>
    </div>

    <div id="product-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content" role="document">
        <button id="modal-close" class="close-btn" aria-label="Cerrar">X</button>
        <div class="modal-left">
          <div class="modal-image-wrap" id="modal-image-wrap">
            <img id="modal-image" src="images/placeholder.png" alt="Imagen del producto">
            <div id="zoom-icon" class="zoom-icon">üîç</div>
          </div>
        </div>
        <div class="modal-right">
          <h3 id="modal-name">Nombre del producto</h3>
          <div id="modal-price" class="price"></div>
          <div id="modal-availability" class="availability"></div>
          <p id="modal-description" style="color:#333;"></p>

          <h4>Especificaciones</h4>
          <ul id="modal-specs" class="spec-list"></ul>

          <h4>Caracter√≠sticas</h4>
          <ul id="modal-features" class="features-list"></ul>

          <div id="modal-stock" style="margin-top:8px;font-weight:700;"></div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 DCPhone</p>
  </footer>

  <script>
    const products = [
      { id: 'Xiaomi Redmi Note 12', name: 'Xiaomi Redmi Note 12', brand: 'Xiaomi', category: 'Celulares', price: '$179.99', image: 'images/XiaomiRedmiNote12.jpeg', description: 'Buen equilibrio entre precio y prestaciones.', specs: ['Pantalla: 6.67"', 'RAM: 6GB', '128GB'], features: ['Carga r√°pida 33W','NFC','Dual SIM'], stock:15, available:true },
      { id: 'Samsung Galaxy S23', name: 'Samsung Galaxy S23', brand: 'Samsung', category: 'Celulares', price: '$699.99', image: 'images/SamsungGalaxyS23.jpg', description: 'Rendimiento alto y c√°mara avanzada.', specs: ['6.1"','8GB','128GB'], features:['Telefoto','IP68'], stock:0, available:false },
      { id: 'iPhone 14', name: 'iPhone 14', brand: 'Apple', category: 'Celulares', price: '$799.00', image: 'images/Iphone14.jpg', description: 'iOS y ecosistema Apple.', specs: ['6.1"','6GB','128GB'], features:['Face ID','MagSafe'], stock:4, available:true },
      { id: 'OnePlus Nord 3', name: 'OnePlus Nord 3', brand: 'OnePlus', category: 'Celulares', price: '$399.99', image: 'images/OnePlusNord3.jpg', description: 'Rendimiento a buen precio.', specs:['6.7"','8GB','128GB'], features:['Carga 80W'], stock:6, available:true },
      { id: 'Huawei P50', name: 'Huawei P50', brand: 'Huawei', category: 'Celulares', price: '$599.99', image: 'images/HuaweiP50.png', description: 'C√°mara premium.', specs:['6.5"','8GB','256GB'], features:['C√°mara Leica'], stock:0, available:false },
      { id: 'Motorola Moto G Stylus', name: 'Motorola Moto G Stylus', brand: 'Motorola', category: 'Celulares', price: '$249.99', image: 'images/moto_g_stylus.jpg', description: 'Incluye stylus.', specs:['6.8"','6GB','128GB'], features:['Stylus'], stock:10, available:true },
      { id: 'Google Pixel 7', name: 'Google Pixel 7', brand: 'Google', category: 'Celulares', price: '$599.00', image: 'images/pixel7.jpg', description: 'Android puro y c√°mara potente.', specs:['6.3"','8GB','128GB'], features:['Tensor'], stock:7, available:true },
      { id: 'Nokia G22', name: 'Nokia G22', brand: 'Nokia', category: 'Celulares', price: '$149.99', image: 'images/nokia_g22.jpg', description: 'Bater√≠a destacada.', specs:['6.5"','4GB','64GB'], features:['Bater√≠a durable'], stock:18, available:true },
      { id: 'PlayStation 5', name: 'PlayStation 5', brand: 'Sony', category: 'Consolas', price: '$499.99', image: 'images/ps5.jpg', description: 'PS5 - nueva generaci√≥n.', specs:['RDNA2','825GB SSD'], features:['DualSense','Ray Tracing'], stock:2, available:true },
      { id: 'Xbox Series X', name: 'Xbox Series X', brand: 'Microsoft', category: 'Consolas', price: '$499.99', image: 'images/xbox_series_x.jpg', description: 'Xbox potente.', specs:['RDNA2','1TB SSD'], features:['Game Pass'], stock:0, available:false },
      { id: 'Nintendo Switch', name: 'Nintendo Switch', brand: 'Nintendo', category: 'Consolas', price: '$299.99', image: 'images/switch.jpg', description: 'Switch h√≠brida.', specs:['CPU: Custom Nvidia','32GB'], features:['Port√°til'], stock:6, available:true },
      { id: 'Nintendo Switch OLED', name: 'Nintendo Switch OLED', brand: 'Nintendo', category: 'Consolas', price: '$349.99', image: 'images/switch_oled.jpg', description: 'Pantalla OLED mejorada.', specs:['OLED','64GB'], features:['Dock incluido'], stock:5, available:true },
      { id: 'MacBook Air M2', name: 'MacBook Air M2', brand: 'Apple', category: 'Computadoras', price: '$999.00', image: 'images/macbook_air.jpg', description: 'MacBook Air con M2.', specs:['M2','8GB','256GB'], features:['Ligera'], stock:5, available:true },
      { id: 'Dell XPS 13', name: 'Dell XPS 13', brand: 'Dell', category: 'Computadoras', price: '$999.99', image: 'images/dell_xps13.jpg', description: 'Port√°til premium.', specs:['i7','16GB','512GB'], features:['Pantalla InfinityEdge'], stock:0, available:false },
      { id: 'Asus ROG Strix', name: 'Asus ROG Strix', brand: 'Asus', category: 'Computadoras', price: '$1499.00', image: 'images/asus_rog.jpg', description: 'Gaming potente.', specs:['i9','32GB','1TB'], features:['RGB','GPU potente'], stock:3, available:true },
      { id: 'iPad Air', name: 'iPad Air', brand: 'Apple', category: 'Tablets', price: '$599.00', image: 'images/ipad_air.jpg', description: 'Tablet ligera y potente.', specs:['10.9"','64GB'], features:['Apple Pencil'], stock:6, available:true },
      { id: 'Samsung Galaxy Tab S8', name: 'Samsung Galaxy Tab S8', brand: 'Samsung', category: 'Tablets', price: '$699.99', image: 'images/tab_s8.jpg', description: 'Tablet Android premium.', specs:['11"','128GB'], features:['S-Pen'], stock:4, available:true },
      { id: 'Lenovo Tab P11', name: 'Lenovo Tab P11', brand: 'Lenovo', category: 'Tablets', price: '$229.99', image: 'images/lenovo_tab.jpg', description: 'Tablet para multimedia.', specs:['11"','64GB'], features:['Funda teclado'], stock:0, available:false },
      { id: 'Apple Watch Series 8', name: 'Apple Watch Series 8', brand: 'Apple', category: 'Relojes inteligentes', price: '$399.00', image: 'images/apple_watch.jpg', description: 'Monitor de salud y notificaciones.', specs:['GPS','ECG'], features:['Detecci√≥n ca√≠das'], stock:9, available:true },
      { id: 'Samsung Galaxy Watch5', name: 'Samsung Galaxy Watch5', brand: 'Samsung', category: 'Relojes inteligentes', price: '$279.99', image: 'images/galaxy_watch.jpg', description: 'Reloj con buena autonom√≠a.', specs:['GPS','AMOLED'], features:['Resistencia agua'], stock:0, available:false },
      { id: 'Fitbit Versa 4', name: 'Fitbit Versa 4', brand: 'Fitbit', category: 'Relojes inteligentes', price: '$199.99', image: 'images/fitbit_versa.jpg', description: 'Enfoque salud y deporte.', specs:['GPS','24/7 HR'], features:['Sue√±o'], stock:11, available:true },
      { id: 'Sony WH-1000XM5', name: 'Sony WH-1000XM5', brand: 'Sony', category: 'Accesorios', price: '$349.99', image: 'images/sony_wh1000xm5.jpg', description: 'Auriculares con cancelaci√≥n.', specs:['Bluetooth 5.2','ANC'], features:['Cancelaci√≥n ruido'], stock:11, available:true },
      { id: 'Logitech MX Master 3', name: 'Logitech MX Master 3', brand: 'Logitech', category: 'Accesorios', price: '$99.99', image: 'images/mx_master3.jpg', description: 'Rat√≥n para productividad.', specs:['Bluetooth','USB-C'], features:['Botones programables'], stock:25, available:true },
      { id: 'GoPro HERO10', name: 'GoPro HERO10', brand: 'GoPro', category: 'C√°maras', price: '$399.99', image: 'images/gopro_hero10.jpg', description: 'C√°mara de acci√≥n.', specs:['5.3K','Estabilizaci√≥n'], features:['Sumergible'], stock:0, available:false },
      { id: 'DJI Mini 3', name: 'DJI Mini 3', brand: 'DJI', category: 'Drones', price: '$549.99', image: 'images/dji_mini3.jpg', description: 'Drone ligero y port√°til.', specs:['4K','30min vuelo'], features:['Visual tracking'], stock:4, available:true }
    ];

    const grid = document.getElementById('products-grid');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-button');
    const categoryToggle = document.getElementById('category-toggle');
    const categoryPanel = document.getElementById('category-panel');

    const selectedCategories = new Set();
    const selectedBrands = new Set();

    // Modal elements
    const modal = document.getElementById('product-modal');
    const modalImage = document.getElementById('modal-image');
    const modalImageWrap = document.getElementById('modal-image-wrap');
    const modalName = document.getElementById('modal-name');
    const modalPrice = document.getElementById('modal-price');
    const modalAvailability = document.getElementById('modal-availability');
    const modalDescription = document.getElementById('modal-description');
    const modalSpecs = document.getElementById('modal-specs');
    const modalFeatures = document.getElementById('modal-features');
    const modalStock = document.getElementById('modal-stock');
    const modalClose = document.getElementById('modal-close');
    const zoomIcon = document.getElementById('zoom-icon');

    // Variables para el zoom con desplazamiento
    let isZoomed = false;
    let isDragging = false;
    let startX, startY;
    let scrollLeft = 0;
    let scrollTop = 0;
    const ZOOM_LEVEL = 2;

    function populateCategoryPanel() {
      const map = {};
      products.forEach(p => {
        const cat = p.category || 'Otros';
        map[cat] = map[cat] || new Set();
        if (p.brand) map[cat].add(p.brand);
      });
      
      categoryPanel.innerHTML = '';
      
      const controls = document.createElement('div');
      controls.style.display = 'flex';
      controls.style.gap = '8px';
      controls.style.marginBottom = '8px';
      
      const btnSelectAll = document.createElement('button');
      btnSelectAll.type = 'button';
      btnSelectAll.textContent = 'Seleccionar todo';
      btnSelectAll.onclick = () => {
        Object.keys(map).forEach(cat => {
          (map[cat] || []).forEach(b => selectedBrands.add(b));
          selectedCategories.add(cat);
        });
        updateCheckboxes();
        filterProducts();
      };
      
      const btnClearAll = document.createElement('button');
      btnClearAll.type = 'button';
      btnClearAll.textContent = 'Limpiar todo';
      btnClearAll.onclick = () => {
        selectedBrands.clear();
        selectedCategories.clear();
        updateCheckboxes();
        filterProducts();
      };
      
      controls.appendChild(btnSelectAll);
      controls.appendChild(btnClearAll);
      categoryPanel.appendChild(controls);

      Object.keys(map).sort().forEach(cat => {
        const catRow = document.createElement('div');
        catRow.className = 'cat-row';
        catRow.dataset.cat = cat;
        catRow.style.borderTop = '1px solid rgba(0,0,0,0.04)';
        catRow.style.padding = '8px 0';
        
        const header = document.createElement('div');
        header.style.display = 'flex';
        header.style.alignItems = 'center';
        header.style.justifyContent = 'space-between';

        const left = document.createElement('div');
        left.style.display = 'flex';
        left.style.alignItems = 'center';
        left.style.gap = '8px';
        
        const catLabel = document.createElement('span');
        catLabel.textContent = cat;
        catLabel.style.cursor = 'pointer';
        catLabel.addEventListener('click', () => {
          if (selectedCategories.has(cat)) selectedCategories.delete(cat);
          else selectedCategories.add(cat);
          updateCheckboxes();
          filterProducts();
        });
        left.appendChild(catLabel);

        const expandBtn = document.createElement('button');
        expandBtn.type = 'button';
        expandBtn.textContent = '‚ñ∏';
        expandBtn.style.border = 'none';
        expandBtn.style.background = 'transparent';
        expandBtn.style.cursor = 'pointer';
        expandBtn.addEventListener('click', () => {
          brandList.classList.toggle('hidden');
          expandBtn.textContent = brandList.classList.contains('hidden') ? '‚ñ∏' : '‚ñæ';
        });

        header.appendChild(left);
        header.appendChild(expandBtn);
        catRow.appendChild(header);

        const brandList = document.createElement('div');
        brandList.style.padding = '8px 12px';
        brandList.style.display = 'grid';
        brandList.style.gridTemplateColumns = '1fr 1fr';
        brandList.style.gap = '6px';
        brandList.className = 'brand-list hidden';
        
        Array.from(map[cat]).sort().forEach(brand => {
          const bwrap = document.createElement('label');
          bwrap.style.display = 'flex';
          bwrap.style.alignItems = 'center';
          bwrap.style.gap = '6px';
          const bchk = document.createElement('input');
          bchk.type = 'checkbox';
          bchk.dataset.brand = brand;
          bchk.addEventListener('change', (e) => {
            if (e.target.checked) selectedBrands.add(brand);
            else selectedBrands.delete(brand);
            filterProducts();
          });
          const btext = document.createElement('span');
          btext.textContent = brand;
          bwrap.appendChild(bchk);
          bwrap.appendChild(btext);
          brandList.appendChild(bwrap);
        });

        catRow.appendChild(brandList);
        categoryPanel.appendChild(catRow);
      });
      
      updateCheckboxes();
    }

    function updateCheckboxes() {
      categoryPanel.querySelectorAll('div[data-cat]').forEach(row => {
        const cat = row.dataset.cat;
        if (selectedCategories.has(cat)) row.classList.add('cat-selected');
        else row.classList.remove('cat-selected');
      });
      
      categoryPanel.querySelectorAll('input[type="checkbox"][data-brand]').forEach(cb => {
        const brand = cb.dataset.brand;
        cb.checked = selectedBrands.has(brand);
      });
    }

    function renderProducts(list){
      grid.innerHTML = '';
      list.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-id', p.id);
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <div class="name">${p.name}</div>
          <div class="price">${p.price}</div>
        `;
        card.addEventListener('click', ()=> openModal(p.id));
        grid.appendChild(card);
      });
    }

    function filterProducts(){
      const q = searchInput.value.trim().toLowerCase();
      const filtered = products.filter(p => {
        if(selectedCategories.size && !selectedCategories.has(p.category)) return false;
        if(selectedBrands.size && !selectedBrands.has(p.brand)) return false;
        const haystack = (p.id + ' ' + (p.description||'') + ' ' + (p.specs||[]).join(' ') + ' ' + (p.features||[]).join(' ')).toLowerCase();
        return q === '' ? true : haystack.includes(q);
      });
      renderProducts(filtered);
      
      const catLabel = selectedCategories.size ? `${selectedCategories.size} categ.` : 'Todas las categor√≠as';
      const brandLabel = selectedBrands.size ? `${selectedBrands.size} marcas` : '';
      categoryToggle.textContent = brandLabel ? `${catLabel} ¬∑ ${brandLabel} ‚ñæ` : `${catLabel} ‚ñæ`;
    }

    // Funciones para el zoom con desplazamiento
    function enableZoom() {
      isZoomed = true;
      modalImage.style.transform = `scale(${ZOOM_LEVEL})`;
      modalImageWrap.classList.add('zoomed');
      zoomIcon.textContent = '‚úï';
      
      // Centrar la imagen al hacer zoom
      const imgRect = modalImage.getBoundingClientRect();
      const wrapRect = modalImageWrap.getBoundingClientRect();
      const centerX = (imgRect.width * ZOOM_LEVEL - wrapRect.width) / 2;
      const centerY = (imgRect.height * ZOOM_LEVEL - wrapRect.height) / 2;
      
      modalImage.style.transform = `scale(${ZOOM_LEVEL}) translate(${-centerX / ZOOM_LEVEL}px, ${-centerY / ZOOM_LEVEL}px)`;
    }

    function disableZoom() {
      isZoomed = false;
      modalImage.style.transform = 'scale(1) translate(0px, 0px)';
      modalImageWrap.classList.remove('zoomed');
      zoomIcon.textContent = 'üîç';
    }

    function toggleZoom() {
      if (isZoomed) {
        disableZoom();
      } else {
        enableZoom();
      }
    }

    function startDrag(e) {
      if (!isZoomed) return;
      
      isDragging = true;
      modalImageWrap.style.cursor = 'grabbing';
      
      const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
      const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
      
      startX = clientX - modalImageWrap.offsetLeft;
      startY = clientY - modalImageWrap.offsetTop;
      scrollLeft = parseFloat(modalImage.style.transform.split('translate(')[1]?.split('px')[0]) || 0;
      scrollTop = parseFloat(modalImage.style.transform.split('translate(')[1]?.split(',')[1]?.split('px')[0]) || 0;
    }

    function duringDrag(e) {
      if (!isDragging || !isZoomed) return;
      
      e.preventDefault();
      
      const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
      const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
      
      const x = clientX - modalImageWrap.offsetLeft;
      const y = clientY - modalImageWrap.offsetTop;
      
      const walkX = (x - startX) * 1.5;
      const walkY = (y - startY) * 1.5;
      
      const newX = scrollLeft - walkX / ZOOM_LEVEL;
      const newY = scrollTop - walkY / ZOOM_LEVEL;
      
      // Limitar el desplazamiento para no salir de los bordes
      const imgRect = modalImage.getBoundingClientRect();
      const wrapRect = modalImageWrap.getBoundingClientRect();
      const maxX = (imgRect.width * ZOOM_LEVEL - wrapRect.width) / (2 * ZOOM_LEVEL);
      const maxY = (imgRect.height * ZOOM_LEVEL - wrapRect.height) / (2 * ZOOM_LEVEL);
      
      const limitedX = Math.max(-maxX, Math.min(maxX, newX));
      const limitedY = Math.max(-maxY, Math.min(maxY, newY));
      
      modalImage.style.transform = `scale(${ZOOM_LEVEL}) translate(${limitedX}px, ${limitedY}px)`;
    }

    function stopDrag() {
      isDragging = false;
      modalImageWrap.style.cursor = isZoomed ? 'grab' : 'pointer';
    }

    function openModal(id){
      const p = products.find(x=>x.id===id);
      if(!p) return;
      
      modalImage.src = p.image;
      modalImage.alt = p.name;
      modalName.textContent = p.name;
      modalPrice.textContent = p.price;
      modalDescription.textContent = p.description;

      // Reset zoom state
      disableZoom();

      // Specs
      modalSpecs.innerHTML = '';
      if(Array.isArray(p.specs) && p.specs.length){
        p.specs.forEach(s=>{
          const li = document.createElement('li'); 
          li.textContent = s; 
          modalSpecs.appendChild(li);
        });
      } else {
        modalSpecs.innerHTML = '<li>N/A</li>';
      }

      // Features
      modalFeatures.innerHTML = '';
      if(Array.isArray(p.features) && p.features.length){
        p.features.forEach(f=>{
          const li = document.createElement('li'); 
          li.textContent = f; 
          modalFeatures.appendChild(li);
        });
      } else {
        modalFeatures.innerHTML = '<li>N/A</li>';
      }

      // Stock
      modalStock.textContent = 'Stock: ' + (typeof p.stock === 'number' ? p.stock : 'N/A');
      if(p.available && p.stock > 0){
        modalAvailability.textContent = 'Disponible';
        modalAvailability.classList.remove('not-available'); 
        modalAvailability.classList.add('available');
      } else {
        modalAvailability.textContent = 'No disponible';
        modalAvailability.classList.remove('available'); 
        modalAvailability.classList.add('not-available');
      }

      // Show modal
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      document.body.classList.add('modal-open');
      try { modalClose.focus({ preventScroll: true }); } catch (e) { modalClose.focus(); }
    }

    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      document.body.classList.remove('modal-open');
      // Reset zoom when closing modal
      disableZoom();
    }

    // Event listeners para el zoom
    zoomIcon.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleZoom();
    });

    // Event listeners para el desplazamiento
    modalImageWrap.addEventListener('mousedown', startDrag);
    modalImageWrap.addEventListener('touchstart', startDrag);
    
    modalImageWrap.addEventListener('mousemove', duringDrag);
    modalImageWrap.addEventListener('touchmove', duringDrag);
    
    modalImageWrap.addEventListener('mouseup', stopDrag);
    modalImageWrap.addEventListener('touchend', stopDrag);
    modalImageWrap.addEventListener('mouseleave', stopDrag);

    // Event listeners generales
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=> {
      if(e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e)=> { 
      if(e.key === 'Escape') closeModal(); 
    });

    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        filterProducts();
      }
    });

    categoryToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      categoryPanel.classList.toggle('hidden');
      const hidden = categoryPanel.classList.contains('hidden');
      categoryPanel.setAttribute('aria-hidden', String(hidden));
    });

    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        filterProducts();
      });
    }

    // Close category panel when clicking outside
    document.addEventListener('click', (e) => {
      if (!categoryDropdown.contains(e.target)) {
        categoryPanel.classList.add('hidden');
        categoryPanel.setAttribute('aria-hidden', 'true');
      }
    });

    // Initialize
    populateCategoryPanel();
    renderProducts(products);
  </script>
</body>
</html>
